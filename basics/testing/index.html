<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ellar - Python ASGI web framework for building fast, efficient and scalable RESTAPIs and server-side application."><link href=https://github.com/python-ellar/ellar/basics/testing/ rel=canonical><link href=../application-context/ rel=prev><link href=../../techniques/configurations/ rel=next><link rel=icon href=../../img/Icon.svg><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.12"><title>Testing -</title><link rel=stylesheet href=../../assets/stylesheets/main.7e359304.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Source Sans Pro";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#testing class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title class="md-header__button md-logo" aria-label data-md-component=logo> <img src=../../img/EllarLogoB.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Testing </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=pink data-md-color-accent=pink aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/python-ellar/ellar title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> eadwinCode/ellar </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Get Started </a> </li> <li class=md-tabs__item> <a href=../../overview/step-one/ class=md-tabs__link> Overview </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../execution-context/ class=md-tabs__link> Essentials </a> </li> <li class=md-tabs__item> <a href=../../techniques/configurations/ class=md-tabs__link> Techniques </a> </li> <li class=md-tabs__item> <a href=../../security/authentication/ class=md-tabs__link> Security </a> </li> <li class=md-tabs__item> <a href=../../cli/introduction/ class=md-tabs__link> CLI </a> </li> <li class=md-tabs__item> <a href=../../openapi/ class=md-tabs__link> OPENAPI </a> </li> <li class=md-tabs__item> <a href=../../websockets/websockets/ class=md-tabs__link> WebSockets </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title class="md-nav__button md-logo" aria-label data-md-component=logo> <img src=../../img/EllarLogoB.png alt=logo> </a> </label> <div class=md-nav__source> <a href=https://github.com/python-ellar/ellar title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> eadwinCode/ellar </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Get Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../overview/step-one/ class=md-nav__link> <span class=md-ellipsis> Overview </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Essentials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Essentials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../execution-context/ class=md-nav__link> <span class=md-ellipsis> Execution Context </span> </a> </li> <li class=md-nav__item> <a href=../dynamic-modules/ class=md-nav__link> <span class=md-ellipsis> Dynamic Modules </span> </a> </li> <li class=md-nav__item> <a href=../injector-scopes/ class=md-nav__link> <span class=md-ellipsis> Injector Scopes </span> </a> </li> <li class=md-nav__item> <a href=../lifespan/ class=md-nav__link> <span class=md-ellipsis> Lifespan </span> </a> </li> <li class=md-nav__item> <a href=../application-context/ class=md-nav__link> <span class=md-ellipsis> Application Context </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Testing </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Testing </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> <li class=md-nav__item> <a href=#unit-testing class=md-nav__link> <span class=md-ellipsis> Unit testing </span> </a> </li> <li class=md-nav__item> <a href=#using-test-factory class=md-nav__link> <span class=md-ellipsis> Using Test Factory </span> </a> <nav class=md-nav aria-label="Using Test Factory"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overriding-providers class=md-nav__link> <span class=md-ellipsis> Overriding Providers </span> </a> </li> <li class=md-nav__item> <a href=#create-application class=md-nav__link> <span class=md-ellipsis> Create Application </span> </a> </li> <li class=md-nav__item> <a href=#overriding-application-conf-during-testing class=md-nav__link> <span class=md-ellipsis> Overriding Application Conf During Testing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#end-to-end-test class=md-nav__link> <span class=md-ellipsis> End-to-End Test </span> </a> <nav class=md-nav aria-label="End-to-End Test"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#testclient class=md-nav__link> <span class=md-ellipsis> TestClient </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../techniques/configurations/ class=md-nav__link> <span class=md-ellipsis> Techniques </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../security/authentication/ class=md-nav__link> <span class=md-ellipsis> Security </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../cli/introduction/ class=md-nav__link> <span class=md-ellipsis> CLI </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../openapi/ class=md-nav__link> <span class=md-ellipsis> OPENAPI </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../websockets/websockets/ class=md-nav__link> <span class=md-ellipsis> WebSockets </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> <li class=md-nav__item> <a href=#unit-testing class=md-nav__link> <span class=md-ellipsis> Unit testing </span> </a> </li> <li class=md-nav__item> <a href=#using-test-factory class=md-nav__link> <span class=md-ellipsis> Using Test Factory </span> </a> <nav class=md-nav aria-label="Using Test Factory"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overriding-providers class=md-nav__link> <span class=md-ellipsis> Overriding Providers </span> </a> </li> <li class=md-nav__item> <a href=#create-application class=md-nav__link> <span class=md-ellipsis> Create Application </span> </a> </li> <li class=md-nav__item> <a href=#overriding-application-conf-during-testing class=md-nav__link> <span class=md-ellipsis> Overriding Application Conf During Testing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#end-to-end-test class=md-nav__link> <span class=md-ellipsis> End-to-End Test </span> </a> <nav class=md-nav aria-label="End-to-End Test"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#testclient class=md-nav__link> <span class=md-ellipsis> TestClient </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/python-ellar/ellar/blob/master/docs/basics/testing.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <a href=https://github.com/python-ellar/ellar/raw/master/docs/basics/testing.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg> </a> <h1 id=testing><strong>Testing</strong><a class=headerlink href=#testing title="Permanent link">&para;</a></h1> <p>Automated testing is the practice of using software tools to automatically run tests on a software application or system, rather than relying on manual testing by humans. It is considered an essential part of software development as it helps increase productivity, ensure quality and performance goals are met, and provide faster feedback loops to developers. Automated tests can include various types such as unit tests, integration tests, end-to-end tests, and more. </p> <p>While setting up automated tests can be tedious, the benefits of increased test coverage and productivity make it an important aspect of software development. Ellar aims to encourage the use of development best practices, including effective testing, by providing various features to assist developers and teams in creating and automating tests. These features include:</p> <ul> <li>automatically generated default unit tests files for components testing</li> <li>offering a util, <code>Test</code> Factory class, that constructs an isolated module/application setup</li> <li>making the Ellar dependency injection system accessible in the testing environment for convenient component mocking.</li> </ul> <p>Ellar is compatible with <code>unittest</code> and <code>pytest</code> testing frameworks in python but in this documentation, we will be using <code>pytest</code>.</p> <h2 id=getting-started><strong>Getting started</strong><a class=headerlink href=#getting-started title="Permanent link">&para;</a></h2> <p>You will need to install <code>pytest</code></p> <div class=highlight><pre><span></span><code>pip<span class=w> </span>install<span class=w> </span>pytest
</code></pre></div> <h2 id=unit-testing><strong>Unit testing</strong><a class=headerlink href=#unit-testing title="Permanent link">&para;</a></h2> <p>In the following example, we test two classes: <code>CarController</code> and <code>CarRepository</code>. For this we need to use <code>TestClientFactory</code> to build them in isolation from the application since we are writing unit test.</p> <p>Looking at the <code>car</code> module we scaffolded earlier, there is a <code>tests</code> folder provided and inside that folder there is <code>test_controllers.py</code> module. We are going to be writing unit test for <code>CarController</code> in there.</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/car/tests/test_controllers.py</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.controllers</span> <span class=kn>import</span> <span class=n>CarController</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.schemas</span> <span class=kn>import</span> <span class=n>CreateCarSerializer</span><span class=p>,</span> <span class=n>CarListFilter</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.services</span> <span class=kn>import</span> <span class=n>CarRepository</span>


<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=p>:</span> <span class=n>CarController</span> <span class=o>=</span> <span class=n>CarController</span><span class=p>(</span><span class=n>repo</span><span class=o>=</span><span class=n>CarRepository</span><span class=p>())</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_create_action</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>anyio_backend</span><span class=p>):</span>
        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
            <span class=n>CreateCarSerializer</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Mercedes&quot;</span><span class=p>,</span> <span class=n>year</span><span class=o>=</span><span class=mi>2022</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;CLS&quot;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=k>assert</span> <span class=n>result</span> <span class=o>==</span> <span class=p>{</span>
            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This action adds a new car&quot;</span><span class=p>,</span>
            <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;CLS&quot;</span><span class=p>,</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Mercedes&quot;</span><span class=p>,</span>
            <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>2022</span><span class=p>,</span>
        <span class=p>}</span>
</code></pre></div> In example above, we aren't really testing anything Ellar-specific. Notice that we are not using dependency injection; rather, we pass an instance of <code>CarController</code> to our <code>CarRepository</code>. This type of testing, where we manually instantiate the classes being tested, is commonly referred to as <strong>isolated testing</strong> because it is framework-independent</p> <h2 id=using-test-factory><strong>Using Test Factory</strong><a class=headerlink href=#using-test-factory title="Permanent link">&para;</a></h2> <p><strong>Test</strong> factory function in <code>ellar.testing</code> package, is a great tool employ for a quick and better test setup. Let's rewrite the previous example using the built-in <code>Test</code> class:</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/car/tests/test_controllers.py</span>
<span class=kn>from</span> <span class=nn>unittest.mock</span> <span class=kn>import</span> <span class=n>patch</span>
<span class=kn>from</span> <span class=nn>ellar.di</span> <span class=kn>import</span> <span class=n>ProviderConfig</span>
<span class=kn>from</span> <span class=nn>ellar.testing</span> <span class=kn>import</span> <span class=n>Test</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.controllers</span> <span class=kn>import</span> <span class=n>CarController</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.schemas</span> <span class=kn>import</span> <span class=n>CreateCarSerializer</span><span class=p>,</span> <span class=n>CarListFilter</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.services</span> <span class=kn>import</span> <span class=n>CarRepository</span>


<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,],</span> 
            <span class=n>providers</span><span class=o>=</span><span class=p>[</span><span class=n>ProviderConfig</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>CarRepository</span><span class=p>)]</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=p>:</span> <span class=n>CarController</span> <span class=o>=</span> <span class=n>test_module</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>CarController</span><span class=p>)</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_create_action</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>anyio_backend</span><span class=p>):</span>
        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
            <span class=n>CreateCarSerializer</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Mercedes&quot;</span><span class=p>,</span> <span class=n>year</span><span class=o>=</span><span class=mi>2022</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;CLS&quot;</span><span class=p>)</span>
        <span class=p>)</span>

        <span class=k>assert</span> <span class=n>result</span> <span class=o>==</span> <span class=p>{</span>
            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This action adds a new car&quot;</span><span class=p>,</span>
            <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;CLS&quot;</span><span class=p>,</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Mercedes&quot;</span><span class=p>,</span>
            <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>2022</span><span class=p>,</span>
        <span class=p>}</span>

    <span class=nd>@patch</span><span class=o>.</span><span class=n>object</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=s1>&#39;get_all&#39;</span><span class=p>,</span> <span class=n>return_value</span><span class=o>=</span><span class=p>[</span><span class=nb>dict</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s1>&#39;CLS&#39;</span><span class=p>,</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;Mercedes&#39;</span><span class=p>,</span> <span class=n>year</span><span class=o>=</span><span class=mi>2023</span><span class=p>)])</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>test_get_all_action</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mock_get_all</span><span class=p>,</span> <span class=n>anyio_backend</span><span class=p>):</span>
        <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=o>.</span><span class=n>get_all</span><span class=p>(</span><span class=n>query</span><span class=o>=</span><span class=n>CarListFilter</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=mi>10</span><span class=p>))</span>

        <span class=k>assert</span> <span class=n>result</span> <span class=o>==</span> <span class=p>{</span>
            <span class=s1>&#39;cars&#39;</span><span class=p>:</span> <span class=p>[</span>
                <span class=p>{</span>
                    <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span> 
                    <span class=s1>&#39;model&#39;</span><span class=p>:</span> <span class=s1>&#39;CLS&#39;</span><span class=p>,</span> 
                    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Mercedes&#39;</span><span class=p>,</span> 
                    <span class=s1>&#39;year&#39;</span><span class=p>:</span> <span class=mi>2023</span>
                <span class=p>}</span>
            <span class=p>],</span> 
            <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;This action returns all cars at limit=10, offset=0&#39;</span>
        <span class=p>}</span>
</code></pre></div> With the <code>Test</code> class, you can create an application execution context that simulates the entire Ellar runtime, providing hooks to easily manage class instances by allowing for mocking and overriding.</p> <p>The <code>Test</code> class has a <code>create_test_module()</code> method that takes a module metadata object as its argument (the same object you pass to the <code>@Module()</code> decorator). This method returns a <code>TestingModule</code> instance which in turn provides a few methods:</p> <ul> <li><a href=#overriding-providers><strong><code>override_provider</code></strong></a>: Essential for overriding <code>providers</code> or <code>guards</code> with a mocked type.</li> <li><a href=#create-application><strong><code>create_application</code></strong></a>: This method will return an application instance for the isolated testing module.</li> <li><a href=#testclient><strong><code>get_test_client</code></strong></a>: creates and return a <code>TestClient</code> for the application which will allow you to make requests against your application, using the <code>httpx</code> library.</li> </ul> <h3 id=overriding-providers><strong>Overriding Providers</strong><a class=headerlink href=#overriding-providers title="Permanent link">&para;</a></h3> <p><code>TestingModule</code> <code>override_provider</code> method allows you to provide an alternative for a provider type or a guard type. For example:</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar.testing</span> <span class=kn>import</span> <span class=n>Test</span>

<span class=k>class</span> <span class=nc>MockCarRepository</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,]</span>
        <span class=p>)</span><span class=o>.</span><span class=n>override_provider</span><span class=p>(</span>
            <span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>MockCarRepository</span>
        <span class=p>)</span>
</code></pre></div> <code>override_provider</code> takes the same arguments as <code>ellar.di.ProviderConfig</code> and in fact, it builds to <code>ProvideConfig</code> behind the scenes. In example above, we created a <code>MockCarRepository</code> for <code>CarRepository</code> and applied it as shown above. We can also create an instance of <code>MockCarRepository</code> and have it behave as a singleton within the scope of <code>test_module</code> instance.</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar.testing</span> <span class=kn>import</span> <span class=n>Test</span>

<span class=k>class</span> <span class=nc>MockCarRepository</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>):</span>
    <span class=k>pass</span>

<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,]</span>
        <span class=p>)</span><span class=o>.</span><span class=n>override_provider</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_value</span><span class=o>=</span><span class=n>MockCarRepository</span><span class=p>())</span>
</code></pre></div> We this, anywhere <code>CarRepository</code> is needed, a <code>MockCarRepository()</code> instance will be applied.</p> <p>In same way, we can override <code>UseGuards</code> used in controllers during testing. For example, lets assume <code>CarController</code> has a guard <code>JWTGuard</code></p> <p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>typing</span>
<span class=kn>from</span> <span class=nn>ellar.common.compatible</span> <span class=kn>import</span> <span class=n>AttributeDict</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>UseGuards</span><span class=p>,</span> <span class=n>Controller</span><span class=p>,</span> <span class=n>ControllerBase</span>
<span class=kn>from</span> <span class=nn>ellar.core.guard</span> <span class=kn>import</span> <span class=n>HttpBearerAuth</span>
<span class=kn>from</span> <span class=nn>ellar.di</span> <span class=kn>import</span> <span class=n>injectable</span>


<span class=nd>@injectable</span><span class=p>()</span>
<span class=k>class</span> <span class=nc>JWTGuard</span><span class=p>(</span><span class=n>HttpBearerAuth</span><span class=p>):</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>authenticate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>credentials</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>typing</span><span class=o>.</span><span class=n>Any</span><span class=p>:</span>
        <span class=c1># JWT verification goes here</span>
        <span class=k>return</span> <span class=n>AttributeDict</span><span class=p>(</span><span class=n>is_authenticated</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;Ellar&#39;</span><span class=p>,</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;ASGI Framework&#39;</span><span class=p>)</span> 


<span class=nd>@UseGuards</span><span class=p>(</span><span class=n>JWTGuard</span><span class=p>)</span>
<span class=nd>@Controller</span><span class=p>(</span><span class=s1>&#39;/car&#39;</span><span class=p>)</span>
<span class=k>class</span> <span class=nc>CarController</span><span class=p>(</span><span class=n>ControllerBase</span><span class=p>):</span>
    <span class=o>...</span>
</code></pre></div> During testing, we can replace <code>JWTGuard</code> with a <code>MockAuthGuard</code> as shown below.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar.testing</span> <span class=kn>import</span> <span class=n>Test</span>
<span class=kn>from</span> <span class=nn>.controllers</span> <span class=kn>import</span> <span class=n>CarController</span><span class=p>,</span> <span class=n>JWTGuard</span>

<span class=k>class</span> <span class=nc>MockAuthGuard</span><span class=p>(</span><span class=n>JWTGuard</span><span class=p>):</span>
    <span class=k>async</span> <span class=k>def</span> <span class=nf>authenticate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>connection</span><span class=p>,</span> <span class=n>credentials</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>typing</span><span class=o>.</span><span class=n>Any</span><span class=p>:</span>
        <span class=c1># Jwt verification goes here.</span>
        <span class=k>return</span> <span class=nb>dict</span><span class=p>(</span><span class=n>first_name</span><span class=o>=</span><span class=s1>&#39;Ellar&#39;</span><span class=p>,</span> <span class=n>last_name</span><span class=o>=</span><span class=s1>&#39;ASGI Framework&#39;</span><span class=p>)</span>


<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,]</span>
        <span class=p>)</span><span class=o>.</span><span class=n>override_provider</span><span class=p>(</span><span class=n>JWTGuard</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>MockAuthGuard</span><span class=p>)</span>
</code></pre></div> <h3 id=create-application><strong>Create Application</strong><a class=headerlink href=#create-application title="Permanent link">&para;</a></h3> <p>We can access the application instance after setting up the <code>TestingModule</code>. You simply need to call <code>create_application</code> method of the <code>TestingModule</code>. </p> <p>For example: <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar.di</span> <span class=kn>import</span> <span class=n>ProviderConfig</span>
<span class=kn>from</span> <span class=nn>ellar.testing</span> <span class=kn>import</span> <span class=n>Test</span>

<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,],</span> 
            <span class=n>providers</span><span class=o>=</span><span class=p>[</span><span class=n>ProviderConfig</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>CarRepository</span><span class=p>)]</span>
        <span class=p>)</span>
        <span class=n>app</span> <span class=o>=</span> <span class=n>test_module</span><span class=o>.</span><span class=n>create_application</span><span class=p>()</span>
        <span class=n>car_repo</span> <span class=o>=</span> <span class=n>app</span><span class=o>.</span><span class=n>injector</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>)</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>car_repo</span><span class=p>,</span> <span class=n>CarRepository</span><span class=p>)</span>
</code></pre></div></p> <h3 id=overriding-application-conf-during-testing><strong>Overriding Application Conf During Testing</strong><a class=headerlink href=#overriding-application-conf-during-testing title="Permanent link">&para;</a></h3> <p>Having different application configurations for different environments is a best practice in software development. It involves creating different sets of configuration variables, such as database connection details, API keys, and environment-specific settings, for different environments such as development, staging, and production.</p> <p>During testing, there two ways to apply or modify configuration.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>In a file</label><label for=__tabbed_1_2>Inline</label></div> <div class=tabbed-content> <div class=tabbed-block> <p>In <code>config.py</code> file, we can define another configuration for testing eg, <code>class TestConfiguration</code> and then we can apply it to <code>config_module</code> when creating <code>TestingModule</code>.</p> <p>For example:</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/config.py</span>

<span class=o>...</span>

<span class=k>class</span> <span class=nc>BaseConfig</span><span class=p>(</span><span class=n>ConfigDefaultTypesMixin</span><span class=p>):</span>
    <span class=n>DEBUG</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>

<span class=k>class</span> <span class=nc>TestingConfiguration</span><span class=p>(</span><span class=n>BaseConfig</span><span class=p>):</span>
    <span class=n>DEBUG</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>ANOTHER_CONFIG_VAR</span> <span class=o>=</span> <span class=s1>&#39;Ellar&#39;</span>
</code></pre></div> We have created <code>TestingConfiguration</code> inside <code>project_name.config</code> python module. Lets apply this to TestingModule.</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/car/tests/test_controllers.py</span>

<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,],</span> 
            <span class=n>providers</span><span class=o>=</span><span class=p>[</span><span class=n>ProviderConfig</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>CarRepository</span><span class=p>)],</span>
            <span class=n>config_module</span><span class=o>=</span><span class=s1>&#39;project_name.config:TestingConfiguration&#39;</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=p>:</span> <span class=n>CarController</span> <span class=o>=</span> <span class=n>test_module</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>CarController</span><span class=p>)</span>
</code></pre></div> Also, we can expose the testing config to environment for more global scope, for example:</p> <div class=highlight><pre><span></span><code><span class=c1># project_name/tests/conftest.py</span>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>from</span> <span class=nn>ellar.constants</span> <span class=kn>import</span> <span class=n>ELLAR_CONFIG_MODULE</span>
<span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>setdefault</span><span class=p>(</span><span class=n>ELLAR_CONFIG_MODULE</span><span class=p>,</span> <span class=s1>&#39;project_name.config:TestingConfiguration&#39;</span><span class=p>)</span>
</code></pre></div> </div> <div class=tabbed-block> <p>This method doesn't require configuration file, we simply go ahead and define the configuration variables in a dictionary type set to <code>config_module</code>. </p> <p>For instance:</p> <div class=highlight><pre><span></span><code><span class=c1># project_name/car/tests/test_controllers.py</span>

<span class=k>class</span> <span class=nc>TestCarController</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,],</span> 
            <span class=n>providers</span><span class=o>=</span><span class=p>[</span><span class=n>ProviderConfig</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>CarRepository</span><span class=p>)],</span>
            <span class=n>config_module</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>DEBUG</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>ANOTHER_CONFIG_VAR</span><span class=o>=</span><span class=s1>&#39;Ellar&#39;</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>controller</span><span class=p>:</span> <span class=n>CarController</span> <span class=o>=</span> <span class=n>test_module</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>CarController</span><span class=p>)</span>
</code></pre></div> </div> </div> </div> <h2 id=end-to-end-test><strong>End-to-End Test</strong><a class=headerlink href=#end-to-end-test title="Permanent link">&para;</a></h2> <p><strong>End-to-end (e2e)</strong> testing operates on a higher level of abstraction than unit testing, assessing the interaction between classes and modules in a way that approximates user behavior with the production system. </p> <p>As an application expands, manual e2e testing of every API endpoint becomes increasingly difficult, which is where automated e2e testing becomes essential in validating that the system's overall behavior is correct and aligned with project requirements. </p> <p>To execute e2e tests, we adopt a similar configuration to that of unit testing, and Ellar's use of <strong>TestClient</strong>, a tool provided by Starlette, to facilitates the simulation of HTTP requests</p> <h3 id=testclient><strong>TestClient</strong><a class=headerlink href=#testclient title="Permanent link">&para;</a></h3> <p>Starlette provides a <a href=https://www.starlette.io/testclient/ target=_blank>TestClient</a> for making requests ASGI Applications, and it's based on <a href=https://www.python-httpx.org/ >httpx</a> library similar to requests. <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>HTMLResponse</span>
<span class=kn>from</span> <span class=nn>starlette.testclient</span> <span class=kn>import</span> <span class=n>TestClient</span>


<span class=k>async</span> <span class=k>def</span> <span class=nf>app</span><span class=p>(</span><span class=n>scope</span><span class=p>,</span> <span class=n>receive</span><span class=p>,</span> <span class=n>send</span><span class=p>):</span>
    <span class=k>assert</span> <span class=n>scope</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;http&#39;</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>HTMLResponse</span><span class=p>(</span><span class=s1>&#39;&lt;html&gt;&lt;body&gt;Hello, world!&lt;/body&gt;&lt;/html&gt;&#39;</span><span class=p>)</span>
    <span class=k>await</span> <span class=n>response</span><span class=p>(</span><span class=n>scope</span><span class=p>,</span> <span class=n>receive</span><span class=p>,</span> <span class=n>send</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>test_app</span><span class=p>():</span>
    <span class=n>client</span> <span class=o>=</span> <span class=n>TestClient</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span>
</code></pre></div> In example above, <code>TestClient</code> needs an <code>ASGI</code> Callable. It exposes the same interface as any other <code>httpx</code> session. In particular, note that the calls to make a request are just standard function calls, not awaitable.</p> <p>Let's see how we can use <code>TestClient</code> in writing e2e testing for <code>CarController</code> and <code>CarRepository</code>.</p> <div class=highlight><pre><span></span><code><span class=c1># project_name/car/tests/test_controllers.py</span>
<span class=kn>from</span> <span class=nn>ellar.di</span> <span class=kn>import</span> <span class=n>ProviderConfig</span>
<span class=kn>from</span> <span class=nn>ellar.testing</span> <span class=kn>import</span> <span class=n>Test</span><span class=p>,</span> <span class=n>TestClient</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.controllers</span> <span class=kn>import</span> <span class=n>CarController</span>
<span class=kn>from</span> <span class=nn>project_name.apps.car.services</span> <span class=kn>import</span> <span class=n>CarRepository</span>


<span class=k>class</span> <span class=nc>MockCarRepository</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>):</span>
    <span class=k>def</span> <span class=nf>get_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=p>[</span><span class=nb>dict</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s1>&#39;CLS&#39;</span><span class=p>,</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;Mercedes&#39;</span><span class=p>,</span> <span class=n>year</span><span class=o>=</span><span class=mi>2023</span><span class=p>)]</span>


<span class=k>class</span> <span class=nc>TestCarControllerE2E</span><span class=p>:</span>
    <span class=k>def</span> <span class=nf>setup</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>test_module</span> <span class=o>=</span> <span class=n>Test</span><span class=o>.</span><span class=n>create_test_module</span><span class=p>(</span>
            <span class=n>controllers</span><span class=o>=</span><span class=p>[</span><span class=n>CarController</span><span class=p>,],</span>
            <span class=n>providers</span><span class=o>=</span><span class=p>[</span><span class=n>ProviderConfig</span><span class=p>(</span><span class=n>CarRepository</span><span class=p>,</span> <span class=n>use_class</span><span class=o>=</span><span class=n>MockCarRepository</span><span class=p>)],</span>
            <span class=n>config_module</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
                <span class=n>REDIRECT_SLASHES</span><span class=o>=</span><span class=kc>True</span>
            <span class=p>)</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=p>:</span> <span class=n>TestClient</span> <span class=o>=</span> <span class=n>test_module</span><span class=o>.</span><span class=n>get_test_client</span><span class=p>()</span>

    <span class=k>def</span> <span class=nf>test_create_action</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>res</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;/car&#39;</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
            <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Mercedes&quot;</span><span class=p>,</span> <span class=n>year</span><span class=o>=</span><span class=mi>2022</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=s2>&quot;CLS&quot;</span>
        <span class=p>))</span>
        <span class=k>assert</span> <span class=n>res</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span>
        <span class=k>assert</span> <span class=n>res</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=o>==</span> <span class=p>{</span>
            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
            <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;This action adds a new car&quot;</span><span class=p>,</span>
            <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=s2>&quot;CLS&quot;</span><span class=p>,</span>
            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;Mercedes&quot;</span><span class=p>,</span>
            <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>2022</span><span class=p>,</span>
        <span class=p>}</span>

    <span class=k>def</span> <span class=nf>test_get_all_action</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>res</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;/car?offset=0&amp;limit=10&#39;</span><span class=p>)</span>
        <span class=k>assert</span> <span class=n>res</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span>
        <span class=k>assert</span> <span class=n>res</span><span class=o>.</span><span class=n>json</span><span class=p>()</span> <span class=o>==</span> <span class=p>{</span>
            <span class=s1>&#39;cars&#39;</span><span class=p>:</span> <span class=p>[</span>
                <span class=p>{</span>
                    <span class=s1>&#39;id&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
                    <span class=s1>&#39;model&#39;</span><span class=p>:</span> <span class=s1>&#39;CLS&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Mercedes&#39;</span><span class=p>,</span>
                    <span class=s1>&#39;year&#39;</span><span class=p>:</span> <span class=mi>2023</span>
                <span class=p>}</span>
            <span class=p>],</span>
            <span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;This action returns all cars at limit=10, offset=0&#39;</span>
        <span class=p>}</span>
</code></pre></div> <p>In the construct above, <code>test_module.get_test_client()</code> created an isolated application instance and used it to instantiate a <code>TestClient</code>. And with we are able to simulate request behaviour on <code>CarController</code>.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 7, 2023</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../application-context/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Application Context"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Application Context </div> </div> </a> <a href=../../techniques/configurations/ class="md-footer__link md-footer__link--next" aria-label="Next: Configuration"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Configuration </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 <a href=https://github.com/eadwinCode target=_blank rel=noopener>Eadwin Ezeudoh</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "search.highlight", "search.share", "search.suggest", "toc.follow", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.prune", "navigation.tabs", "navigation.left", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.c8d2eff1.min.js></script> </body> </html>