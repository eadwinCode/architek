<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ellar - Python ASGI web framework for building fast, efficient and scalable RESTAPIs and server-side application."><link href=https://github.com/python-ellar/ellar/overview/exception_handling/ rel=canonical><link rel=icon href=../../img/Icon.svg><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>Exception Handling -</title><link rel=stylesheet href=../../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Source Sans Pro";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#exceptions-exception-handling class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title class="md-header__button md-logo" aria-label data-md-component=logo> <img src=../../img/EllarLogoB.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Exception Handling </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=pink data-md-color-accent=pink aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=pink data-md-color-accent=pink aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/python-ellar/ellar title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> eadwinCode/ellar </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Get Started </a> </li> <li class=md-tabs__item> <a href=../step-one/ class="md-tabs__link md-tabs__link--active"> Overview </a> </li> <li class=md-tabs__item> <a href=../../basics/execution-context/ class=md-tabs__link> Essentials </a> </li> <li class=md-tabs__item> <a href=../../techniques/configurations/ class=md-tabs__link> Techniques </a> </li> <li class=md-tabs__item> <a href=../../security/authentication/ class=md-tabs__link> Security </a> </li> <li class=md-tabs__item> <a href=../../cli/introduction/ class=md-tabs__link> CLI </a> </li> <li class=md-tabs__item> <a href=../../openapi/ class=md-tabs__link> OPENAPI </a> </li> <li class=md-tabs__item> <a href=../../websockets/websockets/ class=md-tabs__link> WebSockets </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title class="md-nav__button md-logo" aria-label data-md-component=logo> <img src=../../img/EllarLogoB.png alt=logo> </a> </label> <div class=md-nav__source> <a href=https://github.com/python-ellar/ellar title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> eadwinCode/ellar </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <div class="md-nav__link md-nav__link--index "> <a href=../..>Get Started</a> <label for=__nav_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Get Started" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Get Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quick-project/ class=md-nav__link> Quick Setup </a> </li> <li class=md-nav__item> <a href=../../contribution/ class=md-nav__link> Contribution </a> </li> <li class=md-nav__item> <a href=../../release-notes/ class=md-nav__link> Release Notes </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Overview <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Overview data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Overview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../step-one/ class=md-nav__link> Step One </a> </li> <li class=md-nav__item> <a href=../controllers/ class=md-nav__link> Controllers </a> </li> <li class=md-nav__item> <a href=../providers/ class=md-nav__link> Providers </a> </li> <li class=md-nav__item> <a href=../modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../middleware/ class=md-nav__link> Middlewares </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Exception Handling <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Exception Handling </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#built-in-apiexceptions class=md-nav__link> Built-in APIExceptions </a> </li> <li class=md-nav__item> <a href=#throwing-standard-exceptions class=md-nav__link> Throwing standard exceptions </a> </li> <li class=md-nav__item> <a href=#exception-handlers class=md-nav__link> Exception Handlers </a> </li> <li class=md-nav__item> <a href=#creating-custom-exception-handler class=md-nav__link> Creating Custom Exception Handler </a> <nav class=md-nav aria-label="Creating Custom Exception Handler"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-exception-handler-for-status-code class=md-nav__link> Creating Exception Handler for status code </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#registering-exception-handlers class=md-nav__link> Registering Exception Handlers </a> </li> <li class=md-nav__item> <a href=#override-default-exception-handler class=md-nav__link> Override Default Exception Handler </a> </li> <li class=md-nav__item> <a href=#declaring-exception-handler-as-a-function class=md-nav__link> Declaring Exception Handler as a function </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../guards/ class=md-nav__link> Guards </a> </li> <li class=md-nav__item> <a href=../custom_decorators/ class=md-nav__link> Custom Decorators </a> </li> <li class=md-nav__item> <a href=../module-router/ class=md-nav__link> Module Router </a> </li> <li class=md-nav__item> <a href=../interceptors/ class=md-nav__link> Interceptors </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Essentials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Essentials data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Essentials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basics/execution-context/ class=md-nav__link> Execution Context </a> </li> <li class=md-nav__item> <a href=../../basics/dynamic-modules/ class=md-nav__link> Dynamic Modules </a> </li> <li class=md-nav__item> <a href=../../basics/injector-scopes/ class=md-nav__link> Injector Scopes </a> </li> <li class=md-nav__item> <a href=../../basics/lifespan/ class=md-nav__link> Lifespan </a> </li> <li class=md-nav__item> <a href=../../basics/application-context/ class=md-nav__link> Application Context </a> </li> <li class=md-nav__item> <a href=../../basics/testing/ class=md-nav__link> Testing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Techniques <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Techniques data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Techniques </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../techniques/configurations/ class=md-nav__link> Configuration </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <div class="md-nav__link md-nav__link--index "> <a href=../../techniques/validations/ >Input Validations</a> <label for=__nav_4_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Input Validations" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Input Validations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../techniques/validations/path-params/ class=md-nav__link> Path </a> </li> <li class=md-nav__item> <a href=../../techniques/validations/query-params/ class=md-nav__link> Query </a> </li> <li class=md-nav__item> <a href=../../techniques/validations/header-params/ class=md-nav__link> Header </a> </li> <li class=md-nav__item> <a href=../../techniques/validations/cookie-params/ class=md-nav__link> Cookie </a> </li> <li class=md-nav__item> <a href=../../techniques/validations/body/ class=md-nav__link> Body </a> </li> <li class=md-nav__item> <a href=../../techniques/validations/form-params/ class=md-nav__link> Form </a> </li> <li class=md-nav__item> <a href=../../techniques/validations/file-params/ class=md-nav__link> File </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../techniques/serializers/ class=md-nav__link> Serializers </a> </li> <li class=md-nav__item> <a href=../../techniques/response-model/ class=md-nav__link> Response Model </a> </li> <li class=md-nav__item> <a href=../../techniques/versioning/ class=md-nav__link> Versioning </a> </li> <li class=md-nav__item> <a href=../../techniques/caching/ class=md-nav__link> Caching </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_7 type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7> Templating <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Templating data-md-level=2> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Templating </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../techniques/templating/ class=md-nav__link> Html </a> </li> <li class=md-nav__item> <a href=../../techniques/staticfiles/ class=md-nav__link> Static Files </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../techniques/mount/ class=md-nav__link> Mount </a> </li> <li class=md-nav__item> <a href=../../techniques/background-task/ class=md-nav__link> Background Tasks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Security data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../security/authentication/ class=md-nav__link> Authentication </a> </li> <li class=md-nav__item> <a href=../../security/authorization/ class=md-nav__link> Authorization </a> </li> <li class=md-nav__item> <a href=../../security/encryption_and_hashing/ class=md-nav__link> Encryption and Hashing </a> </li> <li class=md-nav__item> <a href=../../security/csrf/ class=md-nav__link> CSRF and CORS </a> </li> <li class=md-nav__item> <a href=../../security/sessions/ class=md-nav__link> Sessions </a> </li> <li class=md-nav__item> <a href=../../security/throttling/ class=md-nav__link> Rate Limiting </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> CLI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CLI data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> CLI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/introduction/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_2 type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2> Commands <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Commands data-md-level=2> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/new-command/ class=md-nav__link> new </a> </li> <li class=md-nav__item> <a href=../../cli/create-project-command/ class=md-nav__link> create project </a> </li> <li class=md-nav__item> <a href=../../cli/create-module-command/ class=md-nav__link> create module </a> </li> <li class=md-nav__item> <a href=../../cli/runserver-command/ class=md-nav__link> runserver </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../cli/custom-commands/ class=md-nav__link> Custom Commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <div class="md-nav__link md-nav__link--index "> <a href=../../openapi/ >OPENAPI</a> <label for=__nav_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=OPENAPI data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> OPENAPI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openapi/security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../openapi/documentation-ui.md class=md-nav__link> Document UI </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> WebSockets <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=WebSockets data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> WebSockets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../websockets/websockets/ class=md-nav__link> index </a> </li> <li class=md-nav__item> <a href=../../websockets/socketio/ class=md-nav__link> Socketio </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#built-in-apiexceptions class=md-nav__link> Built-in APIExceptions </a> </li> <li class=md-nav__item> <a href=#throwing-standard-exceptions class=md-nav__link> Throwing standard exceptions </a> </li> <li class=md-nav__item> <a href=#exception-handlers class=md-nav__link> Exception Handlers </a> </li> <li class=md-nav__item> <a href=#creating-custom-exception-handler class=md-nav__link> Creating Custom Exception Handler </a> <nav class=md-nav aria-label="Creating Custom Exception Handler"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-exception-handler-for-status-code class=md-nav__link> Creating Exception Handler for status code </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#registering-exception-handlers class=md-nav__link> Registering Exception Handlers </a> </li> <li class=md-nav__item> <a href=#override-default-exception-handler class=md-nav__link> Override Default Exception Handler </a> </li> <li class=md-nav__item> <a href=#declaring-exception-handler-as-a-function class=md-nav__link> Declaring Exception Handler as a function </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/python-ellar/ellar/blob/master/docs/overview/exception_handling.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=exceptions-exception-handling><strong>Exceptions &amp; Exception Handling</strong><a class=headerlink href=#exceptions-exception-handling title="Permanent link">&para;</a></h1> <p>Ellar includes a built-in exceptions middleware, known as <code>ExceptionMiddleware</code>, responsible for processing all exceptions that occur within an application. When an exception goes unhandled by your application code, it is intercepted by this middleware, which then automatically sends an appropriate, user-friendly response.</p> <p><div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;status_code&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>403</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;detail&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Forbidden&quot;</span>
<span class=p>}</span>
</code></pre></div> Depending on the application's configuration and the value of <code>DEBUG</code>, the exception handling behavior differs. When <code>config.DEBUG</code> is True, the exception that is raised is shown to the client for easy error debugging. However, when <code>config.DEBUG</code> is False, a 500 error is returned to the client, as illustrated below:</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;statusCode&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>500</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;message&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Internal server error&quot;</span>
<span class=p>}</span>
</code></pre></div> <p>Ellar manages various types of exceptions by default:</p> <ul> <li><strong><code>HTTPException</code></strong>: Provided by <code>Starlette</code> to handle HTTP errors.eg. <code>HTTPException(status_code, detail=None, headers=None)</code></li> <li><strong><code>WebSocketException</code></strong>: Provided by <code>Starlette</code> to manage websocket errors. eg <code>WebSocketException(code=1008, reason=None)</code></li> <li><strong><code>RequestValidationException</code></strong>: Provided by <code>Pydantic</code> for validation of request data</li> <li> <p><strong><code>APIException</code></strong>: It is a type of exception designed for REST API-based applications. It offers a more conceptual approach to handling errors and provides a simple interface for creating other custom exceptions in your application without requiring an additional exception handler.</p> <p>For example,</p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>APIException</span>
<span class=kn>from</span> <span class=nn>starlette</span> <span class=kn>import</span> <span class=n>status</span>

<span class=k>class</span> <span class=nc>ServiceUnavailableException</span><span class=p>(</span><span class=n>APIException</span><span class=p>):</span>
    <span class=n>status_code</span> <span class=o>=</span> <span class=n>status</span><span class=o>.</span><span class=n>HTTP_503_SERVICE_UNAVAILABLE</span>
    <span class=n>code</span> <span class=o>=</span> <span class=s1>&#39;service_unavailable&#39;</span>
</code></pre></div> </li> </ul> <h3 id=built-in-apiexceptions><strong>Built-in APIExceptions</strong><a class=headerlink href=#built-in-apiexceptions title="Permanent link">&para;</a></h3> <p>Ellar offers a set of standard exceptions that inherit from the base <code>APIException</code>. These exceptions are available within the <code>ellar.common</code> package and represent many of the most common HTTP exceptions:</p> <ul> <li><code>AuthenticationFailed</code></li> <li><code>ImproperConfiguration</code></li> <li><code>MethodNotAllowed</code></li> <li><code>NotAcceptable</code></li> <li><code>NotAuthenticated</code></li> <li><code>NotFound</code></li> <li><code>PermissionDenied</code></li> <li><code>UnsupportedMediaType</code></li> </ul> <h2 id=throwing-standard-exceptions><strong>Throwing standard exceptions</strong><a class=headerlink href=#throwing-standard-exceptions title="Permanent link">&para;</a></h2> <p>Let's use the <code>ServiceUnavailableException</code> in our previous project.</p> <p>For example, in the <code>CarController</code>, we have a <code>get_all()</code> method (a <code>GET</code> route handler). Let's assume that this route handler throws an exception for some reason. To demonstrate this, we'll hard-code it as follows:</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/apps/car/controllers.py</span>

<span class=nd>@get</span><span class=p>()</span>
<span class=k>def</span> <span class=nf>get_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
    <span class=k>raise</span> <span class=n>ServiceUnavailableException</span><span class=p>()</span>
</code></pre></div> Now, when you visit <a href=http://127.0.0.1/car/ target=_blank>http://127.0.0.1/car/</a>, you will get a JSON response. <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;detail&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Service Unavailable&quot;</span>
<span class=p>}</span>
</code></pre></div> When we raise the <code>ServiceUnavailableException</code>, it produces a <code>JSON</code> response because <code>Ellar</code> has implemented an exception handler for any <code>APIException</code> exception type. We will see how to change the default exception handler later.</p> <p>Another error presentation is available on the APIException instance:</p> <ul> <li><code>.detail</code>: returns the textual description of the error.</li> <li><code>get_full_details()</code>: returns both the textual description and other information about the error.</li> </ul> <div class=highlight><pre><span></span><code>&gt;&gt;&gt;<span class=w> </span>print<span class=o>(</span>exc.detail<span class=o>)</span>
Service<span class=w> </span>Unavailable
&gt;&gt;&gt;<span class=w> </span>print<span class=o>(</span>exc.get_full_details<span class=o>())</span>
<span class=o>{</span><span class=s1>&#39;detail&#39;</span>:<span class=s1>&#39;Service Unavailable&#39;</span>,<span class=s1>&#39;code&#39;</span>:<span class=s1>&#39;service_unavailable&#39;</span>,<span class=w> </span><span class=s1>&#39;description&#39;</span>:<span class=w> </span><span class=s1>&#39;The server cannot process the request due to a high load&#39;</span><span class=o>}</span>
</code></pre></div> <h2 id=exception-handlers><strong>Exception Handlers</strong><a class=headerlink href=#exception-handlers title="Permanent link">&para;</a></h2> <p>Exception Handlers are classes or functions that handles what response that is returned to the client for specific exception types.</p> <p>Here is an example of an ExceptionHandler that handles <code>HTTPException</code> in the application:</p> <p><div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>typing</span> <span class=k>as</span> <span class=nn>t</span>

<span class=kn>from</span> <span class=nn>ellar.common.interfaces</span> <span class=kn>import</span> <span class=n>IExceptionHandler</span><span class=p>,</span> <span class=n>IHostContext</span>
<span class=kn>from</span> <span class=nn>starlette.exceptions</span> <span class=kn>import</span> <span class=p>(</span>
    <span class=n>HTTPException</span> <span class=k>as</span> <span class=n>StarletteHTTPException</span><span class=p>,</span>
<span class=p>)</span>
<span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>Response</span>


<span class=k>class</span> <span class=nc>HTTPExceptionHandler</span><span class=p>(</span><span class=n>IExceptionHandler</span><span class=p>):</span>
    <span class=n>exception_type_or_code</span> <span class=o>=</span> <span class=n>StarletteHTTPException</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>catch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>ctx</span><span class=p>:</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>StarletteHTTPException</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>.</span><span class=n>Union</span><span class=p>[</span><span class=n>Response</span><span class=p>,</span> <span class=n>t</span><span class=o>.</span><span class=n>Any</span><span class=p>]:</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc</span><span class=p>,</span> <span class=n>StarletteHTTPException</span><span class=p>)</span>
        <span class=n>config</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>get_app</span><span class=p>()</span><span class=o>.</span><span class=n>config</span>

        <span class=k>if</span> <span class=n>exc</span><span class=o>.</span><span class=n>status_code</span> <span class=ow>in</span> <span class=p>{</span><span class=mi>204</span><span class=p>,</span> <span class=mi>304</span><span class=p>}:</span>
            <span class=k>return</span> <span class=n>Response</span><span class=p>(</span><span class=n>status_code</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>headers</span><span class=p>)</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>exc</span><span class=o>.</span><span class=n>detail</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)):</span>
            <span class=n>data</span> <span class=o>=</span> <span class=n>exc</span><span class=o>.</span><span class=n>detail</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;detail&quot;</span><span class=p>:</span> <span class=n>exc</span><span class=o>.</span><span class=n>detail</span><span class=p>,</span> <span class=s2>&quot;status_code&quot;</span><span class=p>:</span> <span class=n>exc</span><span class=o>.</span><span class=n>status_code</span><span class=p>}</span>  <span class=c1># type: ignore[assignment]</span>

        <span class=k>return</span> <span class=n>config</span><span class=o>.</span><span class=n>DEFAULT_JSON_CLASS</span><span class=p>(</span>
            <span class=n>data</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>headers</span>
        <span class=p>)</span>
</code></pre></div> In the example above, <code>HTTPExceptionHandler</code> will be registered in a key-value data structure of exception handlers. Where <code>exception_type_or_code</code> is the key and the <code>HTTPExceptionHandler</code> class is the value. </p> <p>During exception handling, <code>HTTPExceptionHandler.catch</code> method will be called when <code>ExceptionMiddleware</code> detect an exception of type <code>HTTPException</code>. And then, a JSON response is created and returned to the client.</p> <h2 id=creating-custom-exception-handler><strong>Creating Custom Exception Handler</strong><a class=headerlink href=#creating-custom-exception-handler title="Permanent link">&para;</a></h2> <p>To create an exception handler for your custom exception, you need to create a class that follows the <code>IExceptionHandler</code> contract.</p> <p>At the root project folder, create a file named <code>custom_exceptions.py</code>:</p> <div class=highlight><pre><span></span><code><span class=c1># project_name/custom_exceptions.py</span>
<span class=kn>import</span> <span class=nn>typing</span> <span class=k>as</span> <span class=nn>t</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IExceptionHandler</span><span class=p>,</span> <span class=n>IHostContext</span>
<span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>Response</span>


<span class=k>class</span> <span class=nc>MyCustomException</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
    <span class=k>pass</span>


<span class=k>class</span> <span class=nc>MyCustomExceptionHandler</span><span class=p>(</span><span class=n>IExceptionHandler</span><span class=p>):</span>
    <span class=n>exception_type_or_code</span> <span class=o>=</span> <span class=n>MyCustomException</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>catch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>ctx</span><span class=p>:</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>MyCustomException</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>.</span><span class=n>Union</span><span class=p>[</span><span class=n>Response</span><span class=p>,</span> <span class=n>t</span><span class=o>.</span><span class=n>Any</span><span class=p>]:</span>
        <span class=n>app_config</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>get_app</span><span class=p>()</span><span class=o>.</span><span class=n>config</span>
        <span class=k>return</span> <span class=n>app_config</span><span class=o>.</span><span class=n>DEFAULT_JSON_CLASS</span><span class=p>(</span>
            <span class=p>{</span><span class=s1>&#39;detail&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)},</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span>
        <span class=p>)</span>
</code></pre></div> <p><strong>IExceptionHandler</strong> Overview:</p> <ul> <li><code>exception_type_or_code</code>: defines the <code>exception class</code> OR <code>status code</code> as a key to identify an exception handler.</li> <li><code>catch()</code>: define the exception handling code and response a <code>Response</code> object to be returned to the client.</li> </ul> <h3 id=creating-exception-handler-for-status-code><strong>Creating Exception Handler for status code</strong><a class=headerlink href=#creating-exception-handler-for-status-code title="Permanent link">&para;</a></h3> <p>Let's create a handler for the <code>MethodNotAllowedException</code>, which corresponds to the HTTP status code <code>405</code>.</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/apps/custom_exceptions.py</span>
<span class=kn>import</span> <span class=nn>typing</span> <span class=k>as</span> <span class=nn>t</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IExceptionHandler</span><span class=p>,</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>render_template</span>
<span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>Response</span>
<span class=kn>from</span> <span class=nn>starlette.exceptions</span> <span class=kn>import</span> <span class=n>HTTPException</span>

<span class=k>class</span> <span class=nc>MyCustomException</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
    <span class=k>pass</span>


<span class=k>class</span> <span class=nc>MyCustomExceptionHandler</span><span class=p>(</span><span class=n>IExceptionHandler</span><span class=p>):</span>
    <span class=n>exception_type_or_code</span> <span class=o>=</span> <span class=n>MyCustomException</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>catch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>ctx</span><span class=p>:</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>MyCustomException</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>.</span><span class=n>Union</span><span class=p>[</span><span class=n>Response</span><span class=p>,</span> <span class=n>t</span><span class=o>.</span><span class=n>Any</span><span class=p>]:</span>
        <span class=n>app_config</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>get_app</span><span class=p>()</span><span class=o>.</span><span class=n>config</span>
        <span class=k>return</span> <span class=n>app_config</span><span class=o>.</span><span class=n>DEFAULT_JSON_CLASS</span><span class=p>(</span>
            <span class=p>{</span><span class=s1>&#39;detail&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>)},</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span>
        <span class=p>)</span>


<span class=k>class</span> <span class=nc>ExceptionHandlerAction405</span><span class=p>(</span><span class=n>IExceptionHandler</span><span class=p>):</span>
    <span class=n>exception_type_or_code</span> <span class=o>=</span> <span class=mi>405</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>catch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>ctx</span><span class=p>:</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>HTTPException</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>.</span><span class=n>Union</span><span class=p>[</span><span class=n>Response</span><span class=p>,</span> <span class=n>t</span><span class=o>.</span><span class=n>Any</span><span class=p>]:</span>
        <span class=n>context_kwargs</span> <span class=o>=</span> <span class=p>{}</span>
        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;405.html&#39;</span><span class=p>,</span> <span class=n>request</span><span class=o>=</span><span class=n>ctx</span><span class=o>.</span><span class=n>switch_to_http_connection</span><span class=p>()</span><span class=o>.</span><span class=n>get_request</span><span class=p>(),</span> <span class=o>**</span><span class=n>context_kwargs</span><span class=p>)</span>
</code></pre></div> In this code snippet, we've registered a handler for any <code>HTTP</code> exception with a <code>405</code> status code, and we return a template, <code>405.html</code>, as a response. Similarly, you can create an exception handler for the <code>500</code> status code that returns an HTML template.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Ellar will search for <code>405.html</code> in all registered modules. So, within the <code>car</code> folder, create a templates folder and add <code>405.html</code>.</p> </div> <h2 id=registering-exception-handlers><strong>Registering Exception Handlers</strong><a class=headerlink href=#registering-exception-handlers title="Permanent link">&para;</a></h2> <p>We have successfully created two exception handlers <code>ExceptionHandlerAction405</code> and <code>MyCustomExceptionHandler</code> but they are not yet visible to the application.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Using config.py</label><label for=__tabbed_1_2>Using Application Instance</label></div> <div class=tabbed-content> <div class=tabbed-block> <p>In the <code>config.py</code> file, which holds application settings, you can define custom exception handlers to be registered with the <code>ExceptionMiddlewareService</code> during the application's bootstrapping process.</p> <div class=highlight><pre><span></span><code><span class=c1># project_name/config.py</span>
<span class=kn>import</span> <span class=nn>typing</span> <span class=k>as</span> <span class=nn>t</span>
<span class=kn>from</span> <span class=nn>ellar.core</span> <span class=kn>import</span> <span class=n>ConfigDefaultTypesMixin</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IExceptionHandler</span>
<span class=kn>from</span> <span class=nn>.apps.custom_exceptions</span> <span class=kn>import</span> <span class=n>MyCustomExceptionHandler</span><span class=p>,</span> <span class=n>ExceptionHandlerAction405</span>

<span class=k>class</span> <span class=nc>BaseConfig</span><span class=p>(</span><span class=n>ConfigDefaultTypesMixin</span><span class=p>):</span>
    <span class=n>EXCEPTION_HANDLERS</span><span class=p>:</span> <span class=n>t</span><span class=o>.</span><span class=n>List</span><span class=p>[</span><span class=n>IExceptionHandler</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>MyCustomExceptionHandler</span><span class=p>(),</span>
        <span class=n>ExceptionHandlerAction405</span><span class=p>()</span>
    <span class=p>]</span>
</code></pre></div> </div> <div class=tabbed-block> <p>Alternatively, you can add exception handlers directly through the app instance in your application:</p> <div class=highlight><pre><span></span><code><span class=c1># project_name/server.py</span>

<span class=kn>import</span> <span class=nn>os</span>

<span class=kn>from</span> <span class=nn>ellar.common.constants</span> <span class=kn>import</span> <span class=n>ELLAR_CONFIG_MODULE</span>
<span class=kn>from</span> <span class=nn>ellar.core.factory</span> <span class=kn>import</span> <span class=n>AppFactory</span>
<span class=kn>from</span> <span class=nn>.root_module</span> <span class=kn>import</span> <span class=n>ApplicationModule</span>
<span class=kn>from</span> <span class=nn>.apps.custom_exceptions</span> <span class=kn>import</span> <span class=n>MyCustomExceptionHandler</span><span class=p>,</span> <span class=n>ExceptionHandlerAction405</span>

<span class=n>application</span> <span class=o>=</span> <span class=n>AppFactory</span><span class=o>.</span><span class=n>create_from_app_module</span><span class=p>(</span>
    <span class=n>ApplicationModule</span><span class=p>,</span>
    <span class=n>config_module</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=n>ELLAR_CONFIG_MODULE</span><span class=p>,</span> <span class=s2>&quot;project_name.config:DevelopmentConfig&quot;</span>
    <span class=p>),</span>
<span class=p>)</span>

<span class=n>application</span><span class=o>.</span><span class=n>add_exception_handler</span><span class=p>(</span>
    <span class=n>MyCustomExceptionHandler</span><span class=p>(),</span> 
    <span class=n>ExceptionHandlerAction405</span><span class=p>()</span>
<span class=p>)</span>
</code></pre></div> </div> </div> </div> <h2 id=override-default-exception-handler><strong>Override Default Exception Handler</strong><a class=headerlink href=#override-default-exception-handler title="Permanent link">&para;</a></h2> <p>We have seen how to create an exception handler for status codes or for a specific exception type. The same applies to when we want to override an existing exception handler in Ellar project.</p> <p>For example:</p> <p><div class=highlight><pre><span></span><code><span class=c1># project_name/apps/custom_exceptions.py</span>
<span class=kn>import</span> <span class=nn>typing</span> <span class=k>as</span> <span class=nn>t</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>IExceptionHandler</span><span class=p>,</span> <span class=n>APIException</span>
<span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>Response</span>


<span class=k>class</span> <span class=nc>OverrideAPIExceptionHandler</span><span class=p>(</span><span class=n>IExceptionHandler</span><span class=p>):</span>
    <span class=n>exception_type_or_code</span> <span class=o>=</span> <span class=n>APIException</span>

    <span class=k>async</span> <span class=k>def</span> <span class=nf>catch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>ctx</span><span class=p>:</span> <span class=n>IHostContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=n>APIException</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>t</span><span class=o>.</span><span class=n>Union</span><span class=p>[</span><span class=n>Response</span><span class=p>,</span> <span class=n>t</span><span class=o>.</span><span class=n>Any</span><span class=p>]:</span>
        <span class=n>app_config</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>get_app</span><span class=p>()</span><span class=o>.</span><span class=n>config</span>
        <span class=k>return</span> <span class=n>app_config</span><span class=o>.</span><span class=n>DEFAULT_JSON_CLASS</span><span class=p>(</span>
            <span class=p>{</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=n>exc</span><span class=o>.</span><span class=n>detail</span><span class=p>},</span> <span class=n>status_code</span><span class=o>=</span><span class=n>exc</span><span class=o>.</span><span class=n>status_code</span><span class=p>,</span>
        <span class=p>)</span>
</code></pre></div> Once you register the <code>OverrideAPIExceptionHandler</code> exception handler, it will become the default <code>handler</code> for the <code>APIException</code> exception type.</p> <h2 id=declaring-exception-handler-as-a-function><strong>Declaring Exception Handler as a function</strong><a class=headerlink href=#declaring-exception-handler-as-a-function title="Permanent link">&para;</a></h2> <p>In the previous section, we saw how to create a custom ExceptionHandler from <code>IExceptionHandler</code>. In this section, we'll achieve the same result using a plain function.</p> <p>For example, let's say we have a function <code>exception_handler_fun</code> as shown below:</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>PlainTextResponse</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IExecutionContext</span>


<span class=k>def</span> <span class=nf>exception_handler_fun</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=n>IExecutionContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>PlainTextResponse</span><span class=p>(</span><span class=s1>&#39;Bad Request&#39;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>)</span>
</code></pre></div> To make the <code>exception_handler_fun</code> work as an ExceptionHandler, you will need to use <code>CallableExceptionHandler</code> from the <code>ellar.common.exceptions</code> package:</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>PlainTextResponse</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IExecutionContext</span>
<span class=kn>from</span> <span class=nn>ellar.common.exceptions</span> <span class=kn>import</span> <span class=n>CallableExceptionHandler</span>


<span class=k>def</span> <span class=nf>exception_handler_fun</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=n>IExecutionContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>PlainTextResponse</span><span class=p>(</span><span class=s1>&#39;Bad Request&#39;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>)</span>


<span class=n>exception_400_handler</span> <span class=o>=</span> <span class=n>CallableExceptionHandler</span><span class=p>(</span>
    <span class=n>exc_class_or_status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>,</span> <span class=n>callable_exception_handler</span><span class=o>=</span><span class=n>exception_handler_fun</span>
<span class=p>)</span>
</code></pre></div> In the example above, you have created an <code>exception_400_handler</code> Exception Handler to handle HTTP exceptions with a status code of 400. You can then register it as an exception handler in your configuration, as we did in the previous section:</p> <p>Additionally, <code>exception_handler_fun</code> can be configured to handle a custom exception type, as shown below:</p> <p><div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>starlette.responses</span> <span class=kn>import</span> <span class=n>PlainTextResponse</span>
<span class=kn>from</span> <span class=nn>ellar.common</span> <span class=kn>import</span> <span class=n>IExecutionContext</span>
<span class=kn>from</span> <span class=nn>ellar.common.exceptions</span> <span class=kn>import</span> <span class=n>CallableExceptionHandler</span>


<span class=k>class</span> <span class=nc>CustomException</span><span class=p>(</span><span class=ne>Exception</span><span class=p>):</span>
    <span class=k>pass</span>


<span class=k>def</span> <span class=nf>exception_handler_fun</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=n>IExecutionContext</span><span class=p>,</span> <span class=n>exc</span><span class=p>:</span> <span class=ne>Exception</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>PlainTextResponse</span><span class=p>(</span><span class=s1>&#39;Bad Request&#39;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=mi>400</span><span class=p>)</span>


<span class=n>exception_custom_handler</span> <span class=o>=</span> <span class=n>CallableExceptionHandler</span><span class=p>(</span>
    <span class=n>exc_class_or_status_code</span><span class=o>=</span><span class=n>CustomException</span><span class=p>,</span> <span class=n>callable_exception_handler</span><span class=o>=</span><span class=n>exception_handler_fun</span>
<span class=p>)</span>
</code></pre></div> In this example, <code>exception_custom_handler</code> is configured to handle a custom exception type, CustomException.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 22, 2023</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../middleware/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Middlewares" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Middlewares </div> </div> </a> <a href=../guards/ class="md-footer__link md-footer__link--next" aria-label="Next: Guards" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Guards </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 <a href=https://github.com/eadwinCode target=_blank rel=noopener>Eadwin Ezeudoh</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "search.highlight", "search.share", "search.suggest", "toc.follow", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.prune", "navigation.tabs", "navigation.left", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>